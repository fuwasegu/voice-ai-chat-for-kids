import{s as O,N as H,e as y,c as k,b as w,f as m,m as d,i as T,q as W,O as X,P as Y,Q as Z,a2 as ee,a3 as J,a4 as A,n as B,y as te,a as C,g as M,h as S}from"../chunks/scheduler.8tBoJBsa.js";import{S as x,i as E,a as g,t as b,b as I,d as q,m as P,c as Q,e as R,g as F}from"../chunks/index.vFWSQ-8j.js";import{I as N}from"../chunks/Icon.vqmPaIjV.js";import{c as $,s as se}from"../chunks/center.P_nAeEF8.js";import{s as L}from"../chunks/store.nBS5bPhq.js";function ne(n){let e,s,t,a,i;const c=n[2].default,o=H(c,n,n[1],null);return{c(){e=y("button"),o&&o.c(),this.h()},l(r){e=k(r,"BUTTON",{class:!0});var l=w(e);o&&o.l(l),l.forEach(m),this.h()},h(){d(e,"class",s=$({aspectRatio:"1",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"rgb(237, 68, 75)",boxShadow:"0 8px 0 rgb(138, 42, 45)",display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",cursor:n[0]?"wait":"pointer",_hover:{transform:"translate(0, 3px)",boxShadow:"0 2px 0 rgb(138, 42, 45)"}})),e.disabled=n[0]},m(r,l){T(r,e,l),o&&o.m(e,null),t=!0,a||(i=W(e,"click",n[3]),a=!0)},p(r,[l]){o&&o.p&&(!t||l&2)&&X(o,c,r,r[1],t?Z(c,r[1],l,null):Y(r[1]),null),(!t||l&1&&s!==(s=$({aspectRatio:"1",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"rgb(237, 68, 75)",boxShadow:"0 8px 0 rgb(138, 42, 45)",display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",cursor:r[0]?"wait":"pointer",_hover:{transform:"translate(0, 3px)",boxShadow:"0 2px 0 rgb(138, 42, 45)"}})))&&d(e,"class",s),(!t||l&1)&&(e.disabled=r[0])},i(r){t||(g(o,r),t=!0)},o(r){b(o,r),t=!1},d(r){r&&m(e),o&&o.d(r),a=!1,i()}}}function re(n,e,s){let{$$slots:t={},$$scope:a}=e,{disable:i=!1}=e;function c(o){ee.call(this,n,o)}return n.$$set=o=>{"disable"in o&&s(0,i=o.disable),"$$scope"in o&&s(1,a=o.$$scope)},[i,a,t,c]}class ae extends x{constructor(e){super(),E(this,e,re,ne,O,{disable:0})}}const oe=J(L),z=oe.apiKey,ie=async n=>{if(z==="")return"";const e=JSON.stringify({messages:n,model:"gpt-3.5-turbo"});return(await(await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${z}`},body:e})).json()).choices[0].message.content},ce=()=>{const n=new webkitSpeechRecognition;return n.lang="ja-JP",n.continuous=!0,n.interimResults=!0,n},le=async(n=1e3)=>{const e=ce(),s={value:""};let t;const a=()=>t!==void 0&&clearTimeout(t);return new Promise(i=>{e.onresult=c=>{a();const o=Array.from(c.results);s.value=o.reduce((r,l)=>r+l[0].transcript,""),t=setTimeout(()=>{e.stop()},n)},e.onend=()=>{a(),i(s)},e.onerror=c=>{a(),i({value:""})},e.start()})};function ue(n){let e,s;return{c(){e=y("img"),this.h()},l(t){e=k(t,"IMG",{src:!0,alt:!0}),this.h()},h(){A(e.src,s=n[0])||d(e,"src",s),d(e,"alt","robot")},m(t,a){T(t,e,a)},p(t,[a]){a&1&&!A(e.src,s=t[0])&&d(e,"src",s)},i:B,o:B,d(t){t&&m(e)}}}const D="/ROBOT_1.PNG",fe="/ROBOT_2.PNG",pe="/ROBOT_Thinking.PNG",G="/ROBOT_Smiling.PNG";function he(n,e,s){let{status:t="smiling"}=e,{delay:a=1e3}=e,i=G,c;const o=()=>s(0,i=i===D?fe:D);return te(()=>{clearInterval(c)}),n.$$set=r=>{"status"in r&&s(1,t=r.status),"delay"in r&&s(2,a=r.delay)},n.$$.update=()=>{n.$$.dirty&14&&(t==="speaking"?s(3,c=setInterval(o,a)):t==="smiling"?(s(0,i=G),clearInterval(c)):t==="thinking"&&(s(0,i=pe),clearInterval(c)))},[i,t,a,c]}class me extends x{constructor(e){super(),E(this,e,he,ue,O,{status:1,delay:2})}}const ge=async n=>{const e=new SpeechSynthesisUtterance(n);return e.lang="ja-JP",e.rate=1,e.pitch=1,e.volume=1,new Promise(s=>{e.onend=()=>s(),e.onerror=()=>s(),window.speechSynthesis.speak(e)})},de=()=>{const n=J(L);return _e(n.age)},_e=n=>`
これから，あなたは ${n} 歳の子供と１対１で会話をしてもらいます．
したがって，${n} 歳児の相応の喋り方，対応をしてください．
また，返答はできるだけ短く簡潔にお願いします．
そして，難しい言葉を使うことのないように注意してください．
`;class be{queue;capacity;constructor(e){this.queue=[],this.capacity=e}enqueue(e){this.queue.push(e),this.queue.length>this.capacity&&this.queue.shift()}dequeue(){return this.queue.shift()}size(){return this.queue.length}isEmpty(){return this.size()===0}peek(){return this.queue[0]}getFlatList(){return this.queue.flatMap(e=>[e.user,e.assistant])}}function ye(n){let e,s;return e=new N({props:{icon:"bi:mic-fill"}}),{c(){I(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,a){P(e,t,a),s=!0},i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){R(e,t)}}}function ke(n){let e,s;return e=new N({props:{icon:"eos-icons:three-dots-loading"}}),{c(){I(e.$$.fragment)},l(t){q(e.$$.fragment,t)},m(t,a){P(e,t,a),s=!0},i(t){s||(g(e.$$.fragment,t),s=!0)},o(t){b(e.$$.fragment,t),s=!1},d(t){R(e,t)}}}function we(n){let e,s,t,a;const i=[ke,ye],c=[];function o(r,l){return r[0]?0:1}return s=o(n),t=c[s]=i[s](n),{c(){e=y("span"),t.c(),this.h()},l(r){e=k(r,"SPAN",{class:!0});var l=w(e);t.l(l),l.forEach(m),this.h()},h(){d(e,"class",$({fontSize:"60px"}))},m(r,l){T(r,e,l),c[s].m(e,null),a=!0},p(r,l){let u=s;s=o(r),s!==u&&(F(),b(c[u],1,1,()=>{c[u]=null}),Q(),t=c[s],t||(t=c[s]=i[s](r),t.c()),g(t,1),t.m(e,null))},i(r){a||(g(t),a=!0)},o(r){b(t),a=!1},d(r){r&&m(e),c[s].d()}}}function V(n){let e,s,t;return s=new N({props:{icon:"eos-icons:bubble-loading"}}),{c(){e=y("spam"),I(s.$$.fragment),this.h()},l(a){e=k(a,"SPAM",{class:!0});var i=w(e);q(s.$$.fragment,i),i.forEach(m),this.h()},h(){d(e,"class",$({fontSize:"60px"}))},m(a,i){T(a,e,i),P(s,e,null),t=!0},i(a){t||(g(s.$$.fragment,a),t=!0)},o(a){b(s.$$.fragment,a),t=!1},d(a){a&&m(e),R(s)}}}function $e(n){let e,s,t,a,i,c,o,r,l;t=new ae({props:{disable:n[0],$$slots:{default:[we]},$$scope:{ctx:n}}}),t.$on("click",n[4]);let u=n[2]&&V();return r=new me({props:{status:n[1]?"speaking":n[2]?"thinking":"smiling",delay:200}}),{c(){e=y("div"),s=y("div"),I(t.$$.fragment),a=C(),i=y("div"),u&&u.c(),c=C(),o=y("div"),I(r.$$.fragment),this.h()},l(f){e=k(f,"DIV",{class:!0});var p=w(e);s=k(p,"DIV",{class:!0});var h=w(s);q(t.$$.fragment,h),h.forEach(m),a=M(p),i=k(p,"DIV",{class:!0});var _=w(i);u&&u.l(_),_.forEach(m),c=M(p),o=k(p,"DIV",{class:!0});var v=w(o);q(r.$$.fragment,v),v.forEach(m),p.forEach(m),this.h()},h(){d(s,"class",$({marginTop:"80px",height:"120px",width:"120px"})),d(i,"class",$({height:"120px",display:"flex",alignItems:"center"})),d(o,"class",$({width:"300px"})),d(e,"class",se({justify:"center",align:"center"}))},m(f,p){T(f,e,p),S(e,s),P(t,s,null),S(e,a),S(e,i),u&&u.m(i,null),S(e,c),S(e,o),P(r,o,null),l=!0},p(f,[p]){const h={};p&1&&(h.disable=f[0]),p&1025&&(h.$$scope={dirty:p,ctx:f}),t.$set(h),f[2]?u?p&4&&g(u,1):(u=V(),u.c(),g(u,1),u.m(i,null)):u&&(F(),b(u,1,1,()=>{u=null}),Q());const _={};p&6&&(_.status=f[1]?"speaking":f[2]?"thinking":"smiling"),r.$set(_)},i(f){l||(g(t.$$.fragment,f),g(u),g(r.$$.fragment,f),l=!0)},o(f){b(t.$$.fragment,f),b(u),b(r.$$.fragment,f),l=!1},d(f){f&&m(e),R(t),u&&u.d(),R(r)}}}function ve(n,e,s){let t=!1,a=!1,i=!1,c={value:""},o=new be(10);const r=async()=>(s(0,t=!0),c=await le(1e3),s(0,t=!1),c),l=async h=>{s(2,i=!0);const _={role:"system",content:de()},v={role:"user",content:h},U=await ie([_,...o.getFlatList(),v]);s(2,i=!1);const j={role:"assistant",content:U},K={user:v,assistant:j};return o.enqueue(K),j},u=async h=>{s(1,a=!0),await ge(h),s(1,a=!1)},f=async()=>{try{const h=await r();alert(h.value);const _=await l(h.value);alert(_.content),await u(_.content)}catch{s(0,t=!1),s(1,a=!1),s(2,i=!1)}};return[t,a,i,f,()=>f()]}class Te extends x{constructor(e){super(),E(this,e,ve,$e,O,{})}}export{Te as component};
